<link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/_view/back/disk/contextMenu.css" rel="stylesheet">
<script type="text/javascript" src="/assets/common/upload.js"></script>
<script type="text/javascript" src="/_view/back/disk/disk.js"></script>
<script type="text/javascript">
var uploadUtil=new $.uploadUtil();
uploadUtil.setUploadServerUrl("/admin/api/disk/upload");
</script>
<script type="text/html" id="tpl-folder-add-item">
	<div class="disk-item disk-edit">
		<div class="file-thumb" style="background:  url( /assets/disk/diskThumb/folder.png) center no-repeat; ">
		</div>
		<div class="file-name">
			<input class="disk-edit-input" type="text">
			<span class="confirm-create-folder"><i class="fa fa-check"></i></span>
			<span class="cancel-create-folder"><i class="fa fa-close"></i></span>
		</div>
	</div>
</script>
<script type="text/html" id="tpl-disk-item-rename">
	<div class="disk-item disk-edit {{type=="folder"?" disk-folder":"disk-file"}} "   data-id="{{id}}">
		<div class="file-thumb" style="{{style}}" >
		</div>
		<div class="file-name"  data-id="{{id}}">
			<input class="disk-edit-input" type="text" value="{{name}}" >
			<span class="confirm-rename"><i class="fa fa-check"></i></span>
			<span class="cancel-rename"><i class="fa fa-close"></i></span>
		</div>
	</div>
</script>
<script type="text/html" id="tpl-disk-item">
	<div class="disk-item {{type=="folder"?" disk-folder":"disk-file"}} "   data-id="{{id}}">
		<div class="file-thumb" style="background:  url( {{ if(type=="img")}}{{url}}{{else}}/assets/disk/diskThumb/{{type}}.png{{/if}}) center no-repeat;   " >
		</div>
		<div class="file-name">
			<h3 class="overflow-omit" title="{{name}}">{{name}}</h3>
		</div>
	</div>
</script>
<script type="text/html" id="tpl-folder-nav-item">
	<a href="javascript:void(0)" data-id="{{id}}">{{name}}</a>
	<span style="color: #c5d8f3;padding: 0 5px;line-height: 16px;">&gt;</span>
</script>
<script type="text/javascript">
var currentFolderId="#(folderId)";

window.addEventListener("load",function(){
	listDiskItem({parentId:currentFolderId});
	
	if(currentFolderId!=0){
		queryFolderNav(currentFolderId);
	}
})
</script>

<script type="text/javascript">

function removeFile(id){
	$.ajax({
		url:"/admin/api/disk/remove/"+id,
		dataType:"json",
		success:function(data){
			if(fl.isOk(data)){
				$("[data-id='"+id+"']").remove();
			}
		}
	})
}

function rename(element){
	var $element=$(element);
	var $fileNameElement=$element.find(".file-name");
	
	var id=$element.data("id");
	var style=$element.find(".file-thumb").attr("style");
	var name=$fileNameElement.find("h3").text();
	
	var $newElement=$(template("tpl-disk-item-rename",{name:name,id:id,style:style}));
	$fileNameElement.parent().hide();
	$fileNameElement.parent().after($newElement);
}

function confirmRename(element){
	var name=$(element).prev().val();
	var id=$(element).parent().data("id");
	
	$.ajax({
		url:"/admin/api/disk/update",
		data:{id:id,name:name},
		dataType:"json",
		success:function(data){
			if(fl.isOk(data)){
				var type=getType(data.disk.type);
				data.disk.type=type;
				var $afterElement=$(template("tpl-disk-item",data.disk));
				$(element).parent().parent().replaceWith($afterElement);
			}
		}
	})
}

$(function(){
	$(".folder-nva").on("click","a",function(){
		var id=$(this).data("id");
		
		deleteNext(id);
		if(id==0){
			$(".folder-nva").addClass("hide");
			$(".folder-goback").addClass("hide");
			$(".folder-all-info").removeClass("hide");
		}else{
			convertToSpan(this);
		}
		
		listDiskItem({parentId:id});
	})
	
	$(".folder-goback a").click(function(){
		goBackFolder();
	})
	
	$("body").on("click",".confirm-rename",function(){
		confirmRename(this);
	})
	
	$("body").on("click",".cancel-create-folder",function(){
		$(this).parent().parent().remove();
	})
	
	$("body").on("click",".cancel-rename",function(){
		$(this).parent().parent().prev().show();
		$(this).parent().parent().remove();
	})
})
</script>
<style>
.folder-click-nav ul li{
	display: inline-block;
	font-size: 12px;
	line-height: 16px;	
}
.folder-click-nav a{
	color: #4287ed;
}
.folder-click-nav{
	height: 24px;
	margin-bottom: 6px;
	border-bottom: 1px solid #f2f5fa;
}

body,html{
    color: rgb(102, 102, 102);
}
</style>
<div class="disk-main">
	<div class="disk-header clear">
		<div class="header-left float-left">
			<input type="file" class=" disk-upload-file " style="display:none;">
			<button type="button" class="disk-btn inline-block disk-upload-button"><i class="fa fa-cloud-upload"></i><span>上传文件</span></button> 
			<button type="button" class="disk-btn inline-block disk-create-folder">新建文件夹</button>
		</div>
	</div>
	<div class="folder-click-nav">
		<ul>
			<li class="folder-all-info">
				<span>全部文件</span>
			</li>
			
			<li class="folder-goback hide" data-id="">
				<a href="javascript:void(0)">返回上一级</a>
				<span style="color: #c5d8f3;padding: 0 3px;">|</span>
			</li>
			
			<li class="folder-nva hide">
				<a href="javascript:void(0)" data-id="0">全部文件</a>
				 
				<!-- 
				<a href="javascript:void(0)">测试</a>
				<span style="color: #c5d8f3;padding: 0 5px;line-height: 16px;">&gt;</span>
				<span>二级目录</span> -->
			</li>
			
			<li class="float-right">
				<span><span class="disk-folder-num">10</span>个文件夹,<span class="disk-file-num">20</span>个文件</span>
			</li>
		</ul>
	</div>
	<div class="disk-select-line hide">
	 	<div class="select-all">	
	 		<i class="fa fa-check-square"></i>
	 		<i class="fa fa-square-o"></i>
	 		<span>全选</span>
	 	</div>
	 	<div class="select-size">
	 		<i class="fa fa-arrow-down"></i><i class="fa fa-arrow-up"></i><span>大小</span>
	 	</div>
	 	<div class="select-gmtcreate">
	 		<i class="fa fa-arrow-down"></i><i class="fa fa-arrow-up"></i><span>创建时间</span>
	 	</div>
	</div>
	<div class="disk-content clear">
	 
	</div>
</div>
<style>
boyd,html{
	background-color: white;
}
.hide{
	display: none!important;
}
.disk-item{
	width:120px;
	height:120px;
	margin:0 10px;
	float:left;
	border: 1px solid white;
	cursor: pointer;
}
.disk-edit{
	width: 180px;;
    background: white!important;
    border: 0px!important;
}
.disk-edit .file-name{
	z-index:99;
	width: 180px;;
}
.disk-edit-input {
	width: 120px;
	height: 20px;
    vertical-align: middle;
    border: 1px solid #3b8cff;
    border: 1px solid rgba(58,140,255,.3);
    background: #fff;
    border-radius: 2px;
    font-size:10px;
}

.disk-edit input:focus {
    outline: 0;
    -webkit-box-shadow: 0 0 5px 0 #3b8cff;
    -moz-box-shadow: 0 0 5px 0 #3b8cff;
    box-shadow: 0 0 5px 0 #3b8cff;
}

.disk-edit .file-name span {
	 border: 1px solid rgba(58,140,255,.3);
	 display: inline-block;
	 
	 width: 18px;
     vertical-align: middle;
     cursor: pointer;
}

.disk-item:hover{
    border: 1px solid #f1f5fa;
    border-radius: 5px;
    background: #f1f5fa;
}
.file-thumb{
	width:84px;
	height:84px;
	 
    margin: 0 auto;
}

.file-name h3{
	font-size:12px;
	margin: 0px;
}
.file-name{
	width:100%;
	height:30px;
	text-align: center;
}
 
.disk-select-line{
	height:30px;
	line-height: 30px;
	font-size: 12px;	
	    color: #888;
	border-bottom: 1px solid white;
}
.disk-select-line div{
	display: inline-block;
}
.disk-select-line>div>span{
	display: inline-block;
	padding-left: 6px;
}

.select-all{
	width: 60%;
}
.select-all i{
	font-size:1.1rem;
	line-height:32px;
	vertical-align:bottom;
}
.select-all>.fa-square-o{
	font-size:1.2rem;
	line-height:30px;
}
.select-size{
	width: 16%;
}
.select-gmtcreate{
	width: 23%;
}
 
.disk-select-line div:hover{
    background: #f6faff;  
}
 
.disk-upload-file span{
	display:inline-block;
	margin-left:5px;
	
}.disk-upload-file i{
	font-size:1.2rem;
    line-height: 34px;
	vertical-align:bottom;
	
}
</style>
<style>
 .overflow-omit{
	 overflow: hidden;
	text-overflow:ellipsis;
	white-space: nowrap;
}
 .clear:after{/*清除浮动*/
     content: '';
     display:block;
     clear: both;
 }
.disk-main{
	height:100%;
	width: 100%;
	min-height:500px;
}
.disk-header{
	width:100%;
	height:40px;
}
.float-left{
	float:left;
}
.float-right{
	float:right;
}
.header-left{
	width:70%;
}
.header-right{
	width:20%;
}

</style>


<style>
.inline-block{
	display: inline-block;
}
.disk-btn{
  display: inline-block;
  height: 34px;
  line-height: 34px;
  padding: 0 16px;
  white-space: nowrap;
  text-align: center;
  font-size: 14px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  border: 1px solid  #c0d9fe;
  background-color: #fff;
  color: #3b8cff;
}
</style>
<link href="/_view/back/disk/contextMenu.css" rel="stylesheet">
<script type="text/javascript" src="/_view/back/disk/contextMenu.js"></script>
<script type="text/javascript">
$contextMenu.on(".disk-file",[
	{
		events:{
			"click":function(element){
				var id=$(element).data("id");
				download(id);
			}
		},text:"下载"
	},{
		events:{
			"click":function(element){
				rename(element);
			}
		},text:"重命名"
	},{
		events:{
			"click":function(element){
				removeFile($(element).data("id"));
			}
		},text:"删除"
	},{
		events:{
			"click":function(element){
				
			}
		},text:"分享"
	}
]);

$(function(){
	$contextMenu.on(".disk-file",[
		{
			events:{
				"click":function(element,element2){
				
				},"mouseover":function(){
					
				}
			},text:"下载",
			className:"menuGoBack",
			condition:function(){
				return currentFolderId!=0;
			}
		},{
			events:{
				"click":function(element){
					rename(element);
				}
			},text:"重命名"
		}
	]);
})

$contextMenu.on(".disk-main",[
	{
		events:{
			"click":function(element){
				goBackFolder();
			}
		},text:"返回"
		,className:"menuGoBack",
		condition:function(){
			return currentFolderId!=0;
		}
	},
	{	
		events:{
			"click":function(element){
				createFolderItem();
			}
		},text:"新建文件夹"
	},{
		events:{
			"click":function(element){
				window.location.reload();
			}
		},text:"刷新"
	}
]);

$contextMenu.on(".disk-folder",[
	{
		events:{
			"click":function(element){
				$(element).trigger("click");
			}
		},text:"打开"
	},{
		events:{
			"click":function(element){
				rename(element);
			}
		},text:"重命名"
	},{
		events:{
			"click":function(element){
				removeFile($(element).data("id"));
			}
		},text:"删除"
	},{
		events:{
			"click":function(element){
				
			}
		},text:"分享"
	}
]);
</script>