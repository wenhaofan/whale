<style>

@media screen and (max-width: 1200px){
	.table-block{
		width:90%;
		margin: 0 auto;
	}
}

@media screen and (max-width: 768px){
	.layui-form-label{
		width: 50px!important;
	    padding-left:  0px!important;
	}
	.layui-input-block{
	 margin-left: 70px;
	     max-width: 230px;
	}
	   
}
.add-form{
	width:400px;
	margin: 0 auto;
	margin-left:15px;
}
.basic-config{
    width: 500px;

    margin: 1rem 0 0 0rem;}
.quote-level2{
	margin-left:25px;
}
</style> 
<div class="layui-row ">
	<div class="layui-col-lg12 layui-col-md12">
		<blockquote class="layui-elem-quote my-quote ">高级配置</blockquote>
	</div>
</div>

<div class="layui-row">
	<div class="layui-col-xs12 layui-col-md12 layui-col-lg6">
		<blockquote class="layui-elem-quote my-quote quote-level2">metaweblog配置</blockquote>
		<div class="table-block">
			<div class="site-block">
			 	<button class="layui-btn layui-btn-sm madd" >新增</button>
			</div>
			<table id="metaweblog" lay-filter="metaweblogseo"></table>
		</div>
	</div>
	<div class="layui-col-xs12  layui-col-md12 layui-col-lg6">
		<blockquote class="layui-elem-quote my-quote quote-level2">百度推送配置</blockquote>
		<div class="table-block">
			
			<div class="site-block">
			 	<button class="layui-btn layui-btn-sm badd" >新增</button>
			</div>
			<table id="baiduseo" lay-filter="baiduseo"></table>
		</div>
	</div>
</div>
<div class="layui-row" >
	<div class="layui-col-xs12 layui-col-md6 layui-col-lg6">
		<div class="basic-config">
			<blockquote class="layui-elem-quote my-quote quote-level2">基础配置</blockquote>
			<form class="layui-form basicConfig" action=""   onsubmit="return false">
			  <div class="layui-form-item">
			    <label class="layui-form-label">标题</label>
			    <div class="layui-input-block">
			      <input type="hidden" name="id">
			      <input type="text" name="title" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
			    </div>
			  </div>
			  <div class="layui-form-item">
			    <label class="layui-form-label">介绍</label>
			    <div class="layui-input-block">
			      <input type="text" name="description" required  lay-verify="required" placeholder="请输入介绍" autocomplete="off" class="layui-input">
			    </div>
			  </div>
			  <div class="layui-form-item">
			    <label class="layui-form-label">关键字</label>
			    <div class="layui-input-block">
			      <input type="text" name="keywords" required  lay-verify="required" placeholder="请输入关键字" autocomplete="off" class="layui-input">
			    </div>
			  </div>
			  <div class="layui-form-item">
			    <label class="layui-form-label">author</label>
			    <div class="layui-input-block">
			      <input type="text" name="author" required  lay-verify="required" placeholder="请输入作者" autocomplete="off" class="layui-input">
			    </div>
			  </div>
			  <div class="layui-form-item">
			    <div class="layui-input-block">
			      <button  class="layui-btn" lay-submit lay-filter="basicConfig">立即提交</button>
			    </div>
			  </div>
			</form>
		</div>
	</div>
	<div class="layui-col-xs12 layui-col-md6 layui-col-lg6">
		<div class="basic-config">
			<blockquote class="layui-elem-quote my-quote quote-level2">邮箱配置</blockquote>
			<form class="layui-form basicConfig" action="" onsubmit="return false">
			
			  <div class="layui-form-item">
			    <label class="layui-form-label">发件邮箱</label>
			    <div class="layui-input-block">
			      <input type="text" name=fromEmail required  lay-verify="required" placeholder="请输入发件邮箱" autocomplete="off" class="layui-input">
			    </div>
			  </div>
			  <div class="layui-form-item">
			    <label class="layui-form-label">邮件密码</label>
			    <div class="layui-input-block">
			      <input type="text" name="emailPassword" required  lay-verify="required" placeholder="请输入邮件密码" autocomplete="off" class="layui-input">
			    </div>
			  </div>
			  <div class="layui-form-item">
			    <label class="layui-form-label">邮件服务器</label>
			    <div class="layui-input-block">
			      <input type="hidden" name="id">
			      <input type="text" name="emailServer" required  lay-verify="required" placeholder="请输入邮件服务器地址" autocomplete="off" class="layui-input">
			    </div>
			  </div>
			 
			  <div class="layui-form-item">
			    <div class="layui-input-block">
			      <button  class="layui-btn" lay-submit lay-filter="basicConfig">立即提交</button>
			    </div>
			  </div>
			</form>
		</div>
	</div>
</div>
 
<script type="text/html" id="tpl-medit">
<div style="width:500px;padding:10px;">
	<form class="layui-form add-form" onsubmit="return false;">
		    <input type="hidden" name="id" value="{{id}}" >
  		  	<div class="layui-form-item layui-form-text">
	   	 	<label class="layui-form-label">网站名</label>
	    	<div class="layui-input-block">
				
	     		<input type="text" name="website" required  lay-verify="required" value="{{website}}" placeholder="请输入网站名" autocomplete="off" class="layui-input">
	    	</div>
	  	</div>
	  	<div class="layui-form-item layui-form-text">
	   	 	<label class="layui-form-label">接口路径</label>
	    	<div class="layui-input-block">
	     		 <input type="text" name="url" required  lay-verify="required" value="{{url}}" placeholder="请输入接口路径" autocomplete="off" class="layui-input">
	    	</div>
	  	</div>
	  	<div class="layui-form-item layui-form-text">
	   	 	<label class="layui-form-label">账号</label>
	    	<div class="layui-input-block">
	     		 <input type="text" name="userName" required  lay-verify="required " value="{{userName}}"  placeholder="请输入账号" autocomplete="off" class="layui-input">
	    	</div>
	  	</div>
	  	
	  	<div class="layui-form-item layui-form-text">
	   	 	<label class="layui-form-label">密码</label>
	    	<div class="layui-input-block">
	     		 <input type="text" name="password" required  lay-verify="required" value="{{password}}"  placeholder="请输入密码" autocomplete="off" class="layui-input">
	    	</div>
	  	</div>
		  <div class="layui-form-item">
		    <div class="layui-input-block">
		    <button class="layui-btn" lay-submit lay-filter="editMconfig">立即提交</button>
		 </div>
	  </div>
</form>
</div>
</script>
<script type="text/html" id="tpl-bedit">
<div style="width:500px;padding:10px; add-form">
	<form class="layui-form  add-form" onsubmit="return false;">
		<input type="hidden" name="id" value="{{id}}" >
  		  	<div class="layui-form-item layui-form-text">
	   	 	<label class="layui-form-label">网站</label>
	    	<div class="layui-input-block">
	     		<input type="text" name="site" required  lay-verify="required" value="{{site}}" placeholder="请输入网站名" autocomplete="off" class="layui-input">
	    	</div>
	  	</div>
	  	<div class="layui-form-item layui-form-text">
	   	 	<label class="layui-form-label">Token</label>
	    	<div class="layui-input-block">
	     		 <input type="text" name="token" required  lay-verify="required" value="{{token}}" placeholder="请输入token" autocomplete="off" class="layui-input">
	    	</div>
	  	</div>
	  	 
		  <div class="layui-form-item">
		    <div class="layui-input-block">
		    <button class="layui-btn" lay-submit lay-filter="editBconfig"  >立即提交</button>
		 </div>
	  </div>
</form>
</div>
</script>
<script>
addEventListener("load",function(){
	setBasicForm();
})
function setBasicForm(){
	$.ajax({
		url:"/admin/api/basicConfig",
		dataType:"json",
		success:function(data){
			if(fl.isOk(data)){
				formUtil.setFormVal(data.config,$(".basicConfig"));
				formUtil.setFormVal(data.config,$(".basicConfig"));
			}
		}
	})
}
function editBasicConfig(data){
	$.ajax({
		url:"/admin/api/basicConfig/edit",
		data:data,
		type:"post",
		success:function(data){
			if(fl.isOk(data)){
				fl.alertOk({title:"修改成功！"});
			}
		}
	})
}
function renderMEdit(data){
	var content=template("tpl-medit",data);
  	layerIndex=layer.open({
  		title:"新增",
  		area: ['520px', '350px'],
	  	  type: 1, 
	  	  content: content //这里content是一个普通的String
  	});
}
function renderBEdit(data){
	var content=template("tpl-bedit",data);
  	layerIndex=layer.open({
  		title:"新增",
  		area: ['520px', '230px'],
	  	  type: 1, 
	  	  content: content //这里content是一个普通的String
  	});
}

function medit(data){
	$.ajax({
		url:"/admin/api/config/mconfigEdit",
		data:data,
		type:"post",
		success:function(data){
			if(fl.isOk(data)){
				fl.alertOkAndReload();
			}
		}
	})
}
function bedit(data){
	$.ajax({
		url:"/admin/api/config/bconfigEdit",
		data:data,
		type:"post",
		success:function(data){
			if(fl.isOk(data)){
				fl.alertOkAndReload();
			}
		}
	})
}

layui.use(['form','table','laytpl'],function(){
	form=layui.form;
	table=layui.table;
	
	form.render();
	
	table.render({
		elem: '#metaweblog'
	   ,url:'/admin/api/config/mList'
	   ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
	   ,cols: [[
	   	{field:'id', sort: true,width:60,title:"id"}
	     ,{field:'website',title:"网站",width:100}
	     ,{field:'url',title:"接口路径"}
	     ,{field:'userName',title:"账号",width:100}
	     ,{templet:'#tpl-mprivacy',title:"密码",width:150}
	     ,{templet:'#tpl-moperation',title:"操作",width:150}
	   ]]
	 });
	
	table.render({
		  elem: '#baiduseo'
		   ,url:'/admin/api/config/bList'
		   ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
		   ,cols: [[
		   	 {field:'id', sort: true,width:60,title:"id"}
		     ,{field:'site',title:"网站" }
		     ,{templet:'#tpl-bprivacy',title:"token",width:200}
		     ,{templet:'#tpl-boperation',title:"操作",width:150}
		]]
	});
	
	form.on("submit(editMconfig)",function(data){
		medit(data.field);
	})
	form.on("submit(editBconfig)",function(data){
		bedit(data.field);
	})
	
	form.on("submit(basicConfig)",function(data){
		editBasicConfig(data.field);
	})
}) 
</script>
<script type="text/html" id="tpl-mprivacy">
	#[[<span class="privacy" data-content="{{d.password}}">*********</span>]]#
</script>
<script type="text/html" id="tpl-bprivacy">
	#[[<span class="privacy" data-content="{{d.token}}">****************</span>]]#
</script>
<script type="text/html" id="tpl-moperation">
	#[[
		<button class="layui-btn layui-btn-sm mupdate" data-id="{{d.id}}">修改</button> 
		<button class="layui-btn layui-btn-sm mdelete" data-id="{{d.id}}">删除</button>
	]]#
</script>
<script type="text/html" id="tpl-boperation">
	#[[
		<button class="layui-btn layui-btn-sm bupdate" data-id="{{d.id}}" >修改</button> 
		<button class="layui-btn layui-btn-sm bdelete" data-id="{{d.id}}" >删除</button> 
	]]#
</script>
<script type="text/javascript" src="/assets/js/from-util.js"></script>
<script type="text/javascript">
$(function(){
	$("body").on("click",".privacy",function(){
		var content=$(this).data("content");
		var text=$(this).text();
		
		$(this).text(content);
		$(this).data("content",text);
	})
	$("body").on("click",".mupdate",function(){
		$.ajax({
			url:"/admin/api/config/mget/"+$(this).data("id"),
			dataType:'json',
			success:function(data){
				if(fl.isOk(data)){
					renderMEdit(data.config);
				}
			}
		})
 
	})
	$("body").on("click",".bupdate",function(){
		$.ajax({
			url:"/admin/api/config/bget/"+$(this).data("id"),
			dataType:'json',
			success:function(data){
				if(fl.isOk(data)){
					renderBEdit(data.config);
				}
			}
		}) 
	})
	
	$("body").on("click",".madd",function(){
		renderMEdit({});
	})
	$("body").on("click",".badd",function(){
		renderBEdit({});
	})
	
	var deleteMid;
	
	$("body").on("click",".mdelete",function(){
		deleteMid=$(this).data("id");
		fl.alertConfirm({title:"是否确认删除？",then:function(){
			$.ajax({
				url:"/admin/api/config/mconfigDelete/"+deleteMid,
				success:function(data){
					if(fl.isOk(data)){
						fl.alertOkAndReload();
					}
				}
			})
		}})
		
	})
	var deleteBid;
	$("body").on("click",".bdelete",function(){
		deleteBid=$(this).data("id");
		fl.alertConfirm({title:"是否确认删除？",then:function(){
			$.ajax({
				url:"/admin/api/config/bconfigDelete/"+deleteBid,
				success:function(data){
					if(fl.isOk(data)){
						fl.alertOkAndReload();
					}
				}
			})
  
		}});
	})
})
</script>