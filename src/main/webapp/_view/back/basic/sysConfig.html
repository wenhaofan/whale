<script type="text/javascript" src="/assets/js/from-util.js"></script>
<script type="text/javascript" src="/assets/common/kv.js"></script>
<script type="text/javascript">

$(function(){
	$("#add-option").click(function(){
		var $option=$(template("option-tpl",{kv:{}}));
		 $("#basic-mark").before($option);
	})
	
	var initForm={
		callback:function (kvs){
			var $option;
			$.each(kvs,function(index,item){
				 $option=$(template("option-tpl",{kv:item}));
				 $("#basic-mark").before($option);
			})
		}
	}
	
	listKv("basic",initForm);
})

layui.use('form',function(){
	var form = layui.form;
	// 监听提交
	form.on('submit(kvForm)', function(data) {
		var ks=$("input[name='k']");
		var vs=$("input[name='v']");
		var json=[];
		$.each(ks,function(index,item){
			json.push({name:"["+index+"].k",value:ks.eq(index).val()});
			json.push({name:"["+index+"].v",value:vs.eq(index).val()});
			json.push({name:"["+index+"].type",value:"basic"});
		})
		saveKv(json);
		return false;
	});
})


</script>
<style>
main>form{
	width:800px;
	margin:0 auto;
}
.button-group{
	width:200px;
	margin:0 auto;
}
</style>
<div class="layui-row ">
	<div class="layui-col-lg12 layui-col-md12">
		<blockquote class="layui-elem-quote layui-quote-nm">基本信息</blockquote>
	</div>
</div>

<form onsubmit="return false" id="basicForm" class="layui-form">
	<span id="basic-mark" style="display:none;"></span>
	<div class="button-group">
		<div class="col-xs-3 col-xs-offset-4">
			<input type="button" class="layui-btn layui-btn-sm" lay-submit lay-filter="kvForm" value="保存信息" /> 
			<input type="button" id="add-option" class="layui-btn layui-btn-sm" value="添加" />
		</div>
	</div>
</form>

<script type="text/html" id="option-tpl">
	<div class="layui-form-item layui-row">
		<div class="layui-inline layui-col-md2 layui-col-xs2">
	      <input type="text" name="k" value="{{kv.k}}" class="layui-input">
	    </div>
	    <div class="layui-form-mid">:</div>
	    <div class="layui-inline layui-col-md8 layui-col-xs8">
	      <input type="text" name="v" value="{{kv.v}}" class="layui-input">
	    </div>
	</div>
</script>
