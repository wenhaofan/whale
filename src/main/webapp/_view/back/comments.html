 
<div class="layui-row ">
	<div class="layui-col-lg12 layui-col-md12">
		<blockquote class="page-title">评论列表</blockquote>
	</div>
</div>
<!--<div class="site-block">
	<form class="layui-form" method="post">
	  	<div class="layui-form-item">
			<label class="layui-form-label">文章:</label>
			<div class="layui-input-block category-select">
				<select name="categoryId" id="category-select"
					lay-filter="category-select">
				</select>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">状态:</label>
			<div class="layui-input-block state-select">
				<select name="state" id="state-select" lay-filter="state-select">
					<option value="0">未审核</option>
					<option value="1">已审核</option>
					<option value="-1">不限</option>
				</select>
			</div>
		</div>
	</form>
</div>-->
<div style="width:100%;overflow:auto;">
	<table class="layui-hide"   width="auto" style="white-space:nowrap"   id="comments"></table>
</div>


<script type="text/javascript">

layui.use(['layer','table','form'], function(){
	 layer = layui.layer;
	 table = layui.table;
	 form  = layui.form;
	 table.render({
		 page:{count:80,limit:10}
	    ,elem: '#comments'
	    ,url:'/admin/api/comment/page'
	    ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
	    ,cols: [[
	    	{field:'id', sort: true,width:60,title:"id"}
	      ,{field:'name',title:"名称",width:130} //width 支持：数字、百分比和不填写。你还可以通过 minWidth 参数局部定义当前单元格的最小宽度，layui 2.2.1 新增
	      ,{field:'email',title:"邮箱"}
	      ,{field:'website',title:"网址"}
	      ,{field:'content',title:"评论内容"}
	      ,{templet:'#aduit-tpl',width:100,title:"状态"}
	      ,{templet:'#operation-tpl',title:"操作",width:190}
	    ]]
	  });

	 //监听提交
	 form.on('submit(reply)', function(data){
	   submitReply(data.field);
	 	 return false;
	 });
});

function renderReply(){

}

var replyData;
var layerIndex;
function submitReply(info){
	replyData=info;
	fl.alertConfirm({title:"确认回复？",then:function(){
		$.ajax({
			url:"/admin/api/comment/reply",
			type:"post",
			data:replyData,
			success:function(data){
				if(fl.isOk(data)){
					fl.alertOk({title:"回复成功！"});
					layer.close(layerIndex);
				}
			}
		})
	}})

}
$(function(){
	$("body").on("click",".reply",function(){
	  	var toId=	$(this).data("id");
	  	var content=$(this).parent().parent().prev().prev().text();
	  	
	  	var replyHtml=template("tpl-reply",{content:content,toId:toId});
	  	
	  	
	  	layerIndex=layer.open({
	  		title:"回复",
	  		area: ['520px', '350px'],
		  	  type: 1, 
		  	  content: replyHtml //这里content是一个普通的String
	  	});
	})
	
	var aduitInfo;
	var $aduitEle;
	$("body").on("click",".aduit",function(){
		var toId=$(this).data("id");
		var aduit=$(this).data("val");
		aduitInfo={toId:toId,aduit:aduit}
 
		$aduitEle=$(this);
		fl.alertConfirm({title:("确认"+(aduit=="0"?"不通过？":"通过？")),then:function(){
			$.ajax({
				url:"/admin/api/comment/aduit",
				data:aduitInfo,
				success:function(data){
					if(fl.isOk(data)){
						fl.alertOkAndReload();	
					}
				}
			})
		}})
	})
	
	var deleteId;
	$("body").on("click",".delete",function(){
		deleteId=$(this).data("id");
		fl.alertConfirm({title:"确认删除！",then:function(){
			$.ajax({
				url:"/admin/api/comment/delete",
				data:{toId:deleteId},
				success:function(data){
					if(fl.isOk(data)){
						fl.alertOkAndReload();	
					}
				}
			})
		}})
	})
	
	$("body").on("click",".go",function(){
		var pageNum=$(this).data("page");
		var identify=$(this).data("identify");
		var id=$(this).data("id");
		window.open("/article/"+identify+"?p="+pageNum+"#li-comment-"+id);
	})
})

</script>

<script type="text/html" id="aduit-tpl">
  #[[ {{#  if(d.isAduit==1){ }}
   	{{ "审核通过" }}
  {{#  } else if(d.aduit==null) { }}
   	{{ "未审核" }}
  {{# }else{ }}
	{{ "审核未通过"}}
  {{# }}}
	]]#
</script>

<script type="text/html" id="tpl-reply">
<div style="width:500px;padding:10px;">
	<form class="layui-form" onsubmit="return false;">
		<input type="hidden" name="toId" value="{{toId}}" >
  		  	<div class="layui-form-item layui-form-text">
	   	 <label class="layui-form-label">评论内容</label>
	    	<div class="layui-input-block">
	     	 <textarea  maxlength="300" rows="2" cols="40" disabled="disabled" name="content" placeholder="请输入内容" class="layui-textarea">{{content}}</textarea>
	    	</div>
	  	</div>
	  	<div class="layui-form-item layui-form-text">
	   	 <label class="layui-form-label">回答内容</label>
	    	<div class="layui-input-block">
	     	 <textarea  maxlength="300" rows="5" cols="40" name="content" placeholder="请输入内容" class="layui-textarea"></textarea>
	    	</div>
	  	</div>
		  <div class="layui-form-item">
		    <div class="layui-input-block">
		    <button class="layui-btn" lay-submit lay-filter="reply">立即提交</button>
		 </div>
	  </div>
</form>
</div>
</script>
<script type="text/htmp" id="option-tpl">
	<option value="" selected>----<option>
	{{ each categorys }}
		<option value='{{ $value.id}}'>{{  $value.mname }}({{  $value.count }})<option>
	{{ /each }}
</script>
<script type="text/html" id="operation-tpl">
#[[ 
	{{#  if(d.isAduit!=1){ }}
		<button class="layui-btn layui-btn-sm aduit" data-id="{{d.id}}" data-val="1">审核</button> 
	{{# } }}
	<button class="layui-btn layui-btn-sm reply" data-id="{{d.id}}">回复</button>
	{{#  if(d.isAduit==1){ }}
		<button class="layui-btn layui-btn-sm go" data-id="{{d.id}}" data-page="{{d.pageNum}}" data-identify="{{d.identify}}">查看</button>
	{{# } }}
	<button class="layui-btn layui-btn-sm delete" data-id="{{d.id}}">删除</button> 
]]#
</script>
<script type="text/javascript" src="/assets/common/meta.js"></script>